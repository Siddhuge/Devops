name: DevOps Actions
on: workflow_dispatch
jobs:
   Testing:
     runs-on: ubuntu-latest
     steps: 
       - name: Checkout Code
         uses: actions/checkout@v4


       - name: Maven Test
         run: mvn test


       - name: Checkstyle
         run: mvn checkstyle:checkstyle

       - name: Set Java 11
         uses: actions/setup-java@v4
         with:
           java-version: '11'
           distribution: 'temurin'

      #  - name: Cache SonarQube packages
      #    uses: actions/cache@v4
      #    with:
      #       path: ~/.sonar/cache
      #       key: ${{ runner.os }}-sonar
      #       restore-keys: ${{ runner.os }}-sonar

      #  - name: SonarQube Scan
      #    uses: SonarSource/sonar-scanner-action@master
      #    with:
      #       args: >
      #         -Dsonar.projectKey=${{ secrets.SONAR_PROJECT_KEY }}
      #         -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }}
      #    env:
      #      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}


       - name: Setup SonarQube
         uses: warchant/setup-sonar-scanner@v7
       
       - name: Test connectivity to SonarCloud
         run: |
          curl -v --fail https://sonarcloud.io/api/system/status: 

       - name: Test connectivity to SonarQube
         run: |
          curl -v --fail ${{ secrets.SONAR_HOST_URL }}/api/system/status
 

       - name: SonarQube Scan
         run: sonar-scanner
             -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }}
             -Dsonar.login=${{ secrets.SONAR_TOKEN }}
             -Dsonar.organization=${{ secrets.SONAR_ORGANIZATION }}
             -Dsonar.projectKey=${{ secrets.SONAR_PROJECT_KEY }}
             -Dsonar.sources=src/
             -Dsonar.junit.reportPaths=target/surefire-reports/
             -Dsonar.jacoco.reportPaths=target/jacoco.exec
             -Dsonar.java.checkstyle.reportPaths=target/checkstyle-result.xml
             -Dsonar.java.binaries=target/test-classes/com/visualpathit/accounting/

